این پی‌آر‌دی (PRD) متمرکز بر تجربه کاربری موبایل (Flutter) و منطق انتخاب واحد هوشمند است که بر اساس «تطبیق شماره دانشجویی»، «بصری‌سازی چارت» و «الگوریتم اولویت‌بندی» تنظیم شده است.

---

# ۱. Overview (بررسی کلی)

این ماژول وظیفه دارد به محض ورود دانشجو، شماره دانشجویی او را تحلیل کرده، چارت درسی منطبق (رشته + سال ورود) را استخراج و به دو صورت «لیست متنی» و «دیاگرام درختی» نمایش دهد. همچنین بر اساس دروس پاس شده، سیستمی برای پیشنهاد دروس ترم آینده با محاسبات اولویت (اهمیت استراتژیک درس) ارائه دهد.

# ۲. Scope & Out of Scope

* **در محدوده (In Scope):**
* تشخیص خودکار چارت بر اساس پیشوند یا ساختار شماره دانشجویی (مثلاً ۲ رقم اول: سال ورود، ۳ رقم وسط: کد رشته).
* نمایش چارت به دو صورت **List View** (ترم به ترم) و **Diagram View** (نمودار درختی روابط).
* مکانیزم انتخاب دروس پاس شده (Pass/Fail Toggling).
* الگوریتم رتبه‌بندی دروس پیشنهادی بر اساس «تعداد دروس وابسته در آینده».


* **خارج از محدوده (Out of Scope):**
* تغییر چارت توسط دانشجو (چارت‌ها فقط توسط ادمین/مدیرگروه تعریف می‌شوند).



# ۳. User Personas & Use Cases

### پرسونا: آرش (دانشجوی ورودی ۹۹)

آرش می‌خواهد بداند کدام درس‌ها را اگر این ترم بردارد، مسیر فارغ‌التحصیلی‌اش هموارتر می‌شود.

**UC-ID: UI-MATCH-01**

* **عنوان:** تطبیق هوشمند چارت با شماره دانشجویی.
* **جریان:** سیستم شماره `992101001` را می‌خواند. متوجه می‌شود سال ورود `99` و رشته `210` (کامپیوتر) است. چارت ورودی‌های ۹۲ تا ۴۰۲ کامپیوتر را لود می‌کند.

**UC-ID: UI-GRAPH-02**

* **عنوان:** مشاهده دیاگرام تعاملی.
* **جریان:** دانشجو بین تب "لیست" و "نمودار" جابجا می‌شود. در نمودار، دروس به هم متصل هستند و با کلیک روی هر نود، مسیر پیشنیازهای آن هایلایت می‌شود.

# ۴. Functional Requirements (نیازمندی‌های عملکردی)

### ۴.۱. تشخیص چارت (Matching Logic)

* **FR-1:** سیستم باید تابعی داشته باشد که شماره دانشجویی را Parse کند:
* `Entry_Year = StudentID.substring(0, 2)`
* `Major_Code = StudentID.substring(2, 5)`


* **FR-2:** بر اساس این دو متغیر، `ChartSchema` مرتبط را از دیتابیس فراخوانی کند.

### ۴.۲. نمایش دوگانه (Dual View)

* **FR-3 (List View):** نمایش دروس در دسته‌های "ترم ۱" تا "ترم ۸".
* **FR-4 (Diagram View):** استفاده از کتابخانه گراف در فلاتر (مثل `graphview`) برای نمایش درختی. دروس پیشنیاز باید با فلش به دروس بعدی متصل باشند.

### ۴.۳. موتور پیشنهاد واحد (Recommendation Engine)

* **FR-5 (Sorting Logic):** اولویت‌بندی دروس باید بر اساس **وزن استراتژیک (Weight)** باشد.
* **فرمول:** 
* درسی که پیشنیاز ۵ درس دیگر است، اهمیت (Score) بالاتری نسبت به درسی دارد که پیشنیاز هیچ درسی نیست.


* **FR-6:** سیستم نباید دروسی که پیشنیاز آن‌ها پاس نشده را در لیست پیشنهادی "مجاز" نمایش دهد.

# ۵. Non-Functional Requirements (نیازمندی‌های غیرعملیاتی)

* **UX:** در دیاگرام، کاربر باید بتواند با دو انگشت (Pinch to Zoom) زوم کند.
* **Performance:** محاسبه گراف و اولویت‌بندی دروس باید در سمت کلاینت (Flutter) انجام شود تا سرعت پاسخگویی (Responsiveness) بالا برود.

# ۶. UI & Interaction Hints (نکات طراحی رابط کاربری)

* **وضعیت رنگ‌ها در دیاگرام:**
* **سبز:** پاس شده.
* **آبی:** مجاز برای انتخاب (پیشنیازها پاس شده).
* **خاکستری:** غیرمجاز (پیشنیاز پاس نشده).
* **نارنجی:** پیشنهاد ویژه (دارای بالاترین امتیاز اولویت).



# ۷. Analytics & Success Metrics

* **Metric 1:** زمان صرف شده در صفحه دیاگرام (نشان‌دهنده کاربردی بودن بصری‌سازی).
* **Metric 2:** نرخ تطابق (تعداد دفعاتی که کاربر دقیقاً دروس پیشنهادی رتبه ۱ تا ۵ را انتخاب کرده است).

# ۸. Risks & Open Questions

* **ریسک:** شماره دانشجویی‌های خاص (مهمان یا انتقالی) که فرمت متفاوتی دارند.
* *راه حل:* در تنظیمات پروفایل، امکان انتخاب دستی چارت برای این افراد فراهم شود.


* **سوال:** آیا اولویت‌بندی بر اساس "سختی درس" هم مد نظر است یا فقط "تعداد پیشنیازها"؟ (در این فاز فقط تعداد پیشنیازها لحاظ شده است).

# ۹. Acceptance Criteria (معیارهای پذیرش)

1. با وارد کردن شماره دانشجویی، چارت منطبق بدون خطای ۴۰۴ لود شود.
2. در صفحه دیاگرام، با کلیک روی هر درس، تمام دروس پیشنیاز آن تغییر رنگ دهند.
3. لیست دروس پیشنهادی باید دکمه‌ای به نام "چرا این پیشنهاد شده؟" داشته باشد که تعداد واحدهایی که این درس در آینده باز می‌کند را نمایش دهد.
4. دروس "اختیاری" در لیست پیشنهادی با برچسب "انتخابی" مشخص باشند.

